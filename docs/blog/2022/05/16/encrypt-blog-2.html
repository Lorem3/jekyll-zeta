<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <title>encrypt blog 2:12345</title>

  
    
 
     
     
     
  

  <link rel="shortcut icon" type="image/x-icon" href="/no-style-please/logo.png" />
  
  <link rel="stylesheet" href="/no-style-please/assets/css/main.css" />
  
  

</head><body a="auto">
    <main class="page-content" aria-label="Content">
      
      <div class="w"><h1> <a href="/no-style-please/"> no style, please! </a></h1><nav>
    <ul class="navul"><li class="navli"><a href="/no-style-please/">主页</a></li><li class="navli"><a href="/no-style-please/archive.html">归档</a></li><li class="navli"><a href="/no-style-please/tags.html">标签</a></li><li class="navli"><a href="/no-style-please/about.html">关于</a></li></ul>
</nav>
<article>
 
  
  <h1>encrypt blog 2:12345</h1>
  <time datetime="2022-05-16 19:00:58 +0800">2022/05/16</time> &nbsp; &nbsp; 
  
  
      <a href="/no-style-please/tags/encrypt1.html"><text><nobr>#encrypt1</nobr></text>&nbsp;</a>
        
  
      <a href="/no-style-please/tags/blog.html"><text><nobr>#blog</nobr></text>&nbsp;</a>
        
  
      <a href="/no-style-please/tags/no-style-please2.html"><text><nobr>#no-style-please2</nobr></text>&nbsp;</a>
        </span>
<div id="encrypted">
    <h3> Content is Encryped :) </h3>
   
    <input style="width:100%; " type="password" id="passwordinput" placeholder="输入密码"></input>
    <p>
        <input type="button" value= "Decrypt" id="DecryptBtn"/>
        <input type="button" value= "Clear password cache" id="ClearBtn1"/>
    
    </div>
    
    <div id="decrypted"  style = "display:none">
        <p>
        <div>
           
            <input type="button" value= "Encrypt" id="EncryptBtn"/>

            <input type="button" value= "Clear password cache" id="ClearBtn2"/>
           
        </div>
        <div id = 'decryptContent'>
        </div>
    </div>
    <script>
        var exports = exports || {} 
    </script>
    <script src="//cdn.jsdelivr.net/gh/vitock/jsdelivr@0.1.2/js/base64js.js"></script>
    <script>
        !function(){

            const substl = crypto.subtle
            const preFix = 'ea1de90518f654cf7de2c008d4f20ff59';
            const encid = preFix
            const encryptedContent = 'E1.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'
            const base64str = encryptedContent.substring(3)
            const bfMsg = base64js.decode(base64str)
            const bfIv = bfMsg.subarray(0,12)
            const bfCipher = bfMsg.subarray(12)
            
            async function genKey(psw){
                var keyRaw = new TextEncoder().encode(psw)
                var key = await substl.importKey('raw',keyRaw,'PBKDF2',false,["deriveBits"])
                const salt = 'this is a salt string 20221019'
                let pbkdf2  = {
                    name:"PBKDF2",hash: "SHA-256",iterations: 12345,salt: new TextEncoder().encode(salt)
                }
                return  await substl.deriveBits(pbkdf2,key,256);
            }


 
        async function decrypt (key0,isCached){
            // const key = Uint8Array([...]); // 32 bytes key
            
            var key  = ''
            if(isCached){
                key = readKey()
            }
            else{
                var keyS = preFix + key0 +  preFix
                key = await genKey(keyS)
            }
            if (key.length == 0) {
                return
            }

            var aeskey = {
                name:"AES-GCM",
                length:256
            }
            var keyObj = await substl.importKey('raw',key,aeskey,false,['decrypt'])
            var aesDec= {name: "AES-GCM",iv:bfIv,tagLength:128}
            try {
                var bfDec  = await substl.decrypt(aesDec,keyObj,bfCipher)
                var plain = new TextDecoder().decode(bfDec);
                setKey(key)
                document.getElementById("encrypted").style.display = 'none'
                // / show decrypted 
    
                document.getElementById("decrypted").style.display = 'block'
                document.getElementById("decryptContent").innerHTML = plain
    
                setTimeout(function(){
                    var loadevent = document.createEvent("Event")
                    loadevent.initEvent("load", true, true)
    
                    var DOMContentLoaded_event = document.createEvent("Event")
                    DOMContentLoaded_event.initEvent("DOMContentLoaded", true, true)
    
                    window.dispatchEvent(loadevent)
                    window.dispatchEvent(DOMContentLoaded_event)
    
                }, 500);
            } catch (error) {
                alert("wrong password.")
            }
        }
        
        document.getElementById("DecryptBtn").onclick = function(){
            var key = document.getElementById("passwordinput").value
            decrypt(key);        
        }
    
        document.getElementById("EncryptBtn").onclick = function(){
            /// hide input
            document.getElementById("encrypted").style.display = 'block'
            // / show decrypted 
            document.getElementById("decrypted").style.display = "none"
    
            clearKey()
        }

        document.getElementById("EncryptBtn").onclick = function(){
            /// hide input
            document.getElementById("encrypted").style.display = 'block'
            // / show decrypted 
            document.getElementById("decrypted").style.display = "none"
    
            clearKey()
        }

        document.getElementById("ClearBtn1").onclick = function(){
            localStorage.clear();
        }
        document.getElementById("ClearBtn2").onclick = function(){
            localStorage.clear();
        }

        

        
    
        
            function readKey(){
                var key = encid;
                var v = localStorage.getItem(key)
                if (v) {
                    return base64js.decode(v)
                }else{
                    return null
                }
            }
            function setKey(value){
                var key = encid
                var arr = new Uint8Array(value)
                var b64 = base64js.encode(arr)
                return localStorage.setItem(key,b64)
            }
            function clearKey() {
                var key = encid
                localStorage.removeItem(key)
            }
            var cachekey = readKey()
            if(cachekey){
                decrypt(cachekey,true)
            }

        
        
        
 
    }()
    
    </script>
    
  
  
</article>

      </div>
    </main>
  </body>
</html>